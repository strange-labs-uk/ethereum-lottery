# Ethereum HashKeyRaffle Demo

This repository is yet another prototype of a raffle DApp which is currently just a renamed fork of [SampleCrowdsale.sol](https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/examples/SampleCrowdsale.sol) obtained from the examples shared by [OpenZeppelin](https://github.com/OpenZeppelin/zeppelin-solidity) (an ERC20 token template).

    git clone https://github.com/strange-labs-uk/ethereum-raffle

## Truffle

To deploy the `HashKeyRaffle` DApp on a truffle server, do the following:

    npm install -g truffle
    cd ethereum-raffle/truffle
    npm install
    truffle develop

In the `truffle(develop)>` console:

    migrate --reset

The best thing to do to ensure that the contract is functioning as expected seems to be to build unit tests into `test/HashKeyRaffle.test.js` and run `test` inside `truffle(develop)>` console.

## Front-end

After you have the truffle contract deployed using the instructions above, now you can use the front-end to interact with functions from the deployed contract using a simple web interface. However, make sure you have [MetaMask](https://metamask.io) installed on your browser and have added one of the 10 accounts generated by truffle using the respective private key provided.

To serve it:

    cd ethereum-raffle/frontend
    npm install
    npm start

Then browse to http://localhost:3000.

## Deploy contract to test frontend

In one console - get a truffle develop going:

```bash
truffle develop
```

Then, in another console window, we compile and migrate:

```bash
truffle compile
truffle migrate --reset
```

Then we run our initializing script which creates a game:

```bash
truffle exec scripts/initGame.js
```

**NOTE** - if this command fails - try again!

TODO: explain why ^

You can set the following variables:

 * `SECRET_KEY` (default = `apples`)
 * `TICKET_PRICE` (default = `1000`)
 * `DRAW_PERIOD` (default = `30`)
 * `START_TIME` (default = `lastBlockTime + 60 seconds`)
 * `DURATION` (default = `5 * 60`)
 * `FEE_PERCENT` (default = `10`)
 * `MIN_PLAYERS` (default = `1`)

For example:

```bash
SECRET_KEY=oranges TICKET_PRICE=100 truffle exec scripts/initGame.js
```




